# 10장 코드 추가에 대한 두려움 떨쳐내기

이번장에서 다룰 내용

- 코드 추가에 대힌 두려움의 증상
- 코드 추가에 대한 두려움의 극복
- 코드 중복의 장단점 이해
- 이전 버전과의 호환성 보장
- 기능 토글로 위험 낮추기

### 불확실성 받아들이기: 위험 감수

- 팀 생산성의 가장 큰 예측 변수는 심리적 안정
- 모두가 불편한 상황을 피하려는 타고난 경향이 있지만 최고의 연극은 그런 상황에 맞서서 그 위에 쎃은 것에서 나옴
- 첫날 무언가를 프로덕션에 배치하면 두려움과 불안이 없어지고 팀에 가치를 전달하는법을 배울 수 있음
- 두렵지 않을 때까지 시도하기

### 두려움 극복을 위한 스파이크 사용

- 두려움은 종종 생산성을 가로막음
- 무언가 시도하기 전에 만드는 방법에 대해 토론하거나 설계해야한다는 강박관념이 들게함
- 권장되는 개발 작업 절차
  1. 탐색
  2. 명세화
  3. 구현
  4. 테스트
  5. 리팩터링
  6. 전달
- 스파이크 동안 생성된 코드는 메인으로 들어가지 않기때문에 결함이 있는지 여부가 중요하지 않아서 두려움은 사라짐
- 스파이크 코드는 프로덕션에 사용하지 않아야함
- 스파이크 코드는 가설 실험 및 사용자 친화성을 테스트 할 수 있음

### 낭비나 위험에 대한 두려움 극복을 위한 사용 시간 비율 지정

- 개발 도구와 파이프라인이 실제 프로덕션 코드보다 훨씬 더 정교한 경우 코드가 두려워질 수 있음
- 비즈니스로직보다 테스트 환경, 저장소 구조, 시스템, 프레임워크, 자동화된 빌드 및 배포를 설정하는데 많은 시간을 소비하기도함
- 여기에 많은 시간을 사용하는 것은 위험에 대한 두려움이 큰 것
- 지원 도구의 유지보수 및 개발과 같은 **비기능 요구사항**에 개발자 시간의 20% 할당할 것을 권장함
- 필자가 권장하는 방법은 요청사항이 발생하지 않는 모든 작업을 금요일에 몰아서 하는 것 -> 자연스럽게 20% 정도의 시간만 사용할 수 있게됨

### 불완전성에 대한 두려움 극복을 위한 점진적 개선

- **가면 증후군**은 스스로를 자격이 없는 사람으로 간주하여 누군가 자신을 사기꾼으로 폭로할까봐 두려워하는 것
- 자신을 보호하기위해 코드를 완벽하게 만들려는 마음으로 코드를 공개하지 않아서 생산성에 영향을 미침
- 누군가 코드에 대해 비판하는 것을 의식하는 것은 가면증후군으로 이어질 수 있음
- 코드를 작성할 때 한번에 너무 많은 지표를 감안하기는 어려움
- 코드 피드백 주기를 짧게 가지면 빠르게 개선하여 품을 향상시킬 수 있음

### 복사 및 붙여넣기가 속도에 미치는 영향

- 1.코드를 여러곳에서 공유하면 코드가 사용되는 모든 위치에 영향을 미치기 쉬움
- 전역적인 변경을 신속하게 할 수 있음
- 하지만 호출 측의 한 부분에 대해서만 동작을 변경하는 것을 어려움
- 반면 코드를 복사해서 동작을 공유하면 각 호출이 분리되어 호출하는 측에 따라 변경하기 쉬움
- -> 코드를 공유하면 전역적인 동작 변경속도가 증가하고, 코드를 복사하면 지역적인 동작 변경속도가 증가함
- 2.전역적인 동작 변경 속도가 높다는 것은 코드의 여러 다른 위치에 동시에 영향을 줄 수 있는 것을 의미함
- 코드상으로 관련이 없어 보이는 곳에서 손상을 일으킬 수 있음
- = 코드 공유는 시스템 취약성을 증가시킴

### 확장성을 통한 추가에 의한 변경

- 모든 것을 확장가능하게 만드는 것은 코드를 불필요하게 복잡하게 만들어 낭비임
- 도메인과 관련되지 않은 복잡성 = `우발적 복잡성`
- 도메인으로부터 발생한 복잡성 = `본질적 복잡성`
- 우발적 복잡성을 제한하기 위해 필요할 때까지 변형지점의 도입을 연기해야함
- 리팩터링 패턴: 확장-수축 패턴 은 일반적으로 데이터베이스에 주요 변경 사항을 안전하게 도입하는데 사용함
  1. 확장 단계에서 새로운 기능 추가. 유지보수 해야할 동일한 동작에 대한 코드가 두개 존재
  2. 호출자를 새로운 기능으로 천천히 이동시키면서 마이그레이션
  3. 모든 호출자의 변경이 완료되면 수축 단계를 수행해서 원래 버전의 코드를 삭제
- 코드를 좀 더 확장 가능하게 만드는 두가지 방법 (**클래스로 타입 코드 대체, 전략 패턴의 도입**)

### 추가에 의한 변경으로 이전 버전과의 호환성 확보

- 코드를 버전화할 때는 호출자에게 변경에 대한 두려움 없이 기존 버전을 계속 사용할 수 있는 옵션 제공
- 기존 기능을 변경하지 않고 유지하고, 변경사항은 새로 추가만 하는 것이 가장 안전함
- 이전 버전의 모니터링을 통해, 사용하지 않는 것으로 파악되면 삭제할 수 있음

### 기능 토클 (켜기/끄기)로 추가에 의한 변경

- 동료의 코드와 병합하는 것을 통합이라고함
- 코드를 자주 작은 주기로 통합하면 오류가 줄어들고 시간이 절약되며 병합 충돌에 대한 두려움을 줄일 수 있음
- 사용자가 코드를 사용할 준비가 되지 않았다면 if(false) 블록으로 감싸서 배포하여 코드를 강제로 포함시킬 수도 있음
- <코드 참고>
- 토글 기능을 이용해서 새로운 기능을 배포할 수 있음
- 로컬에서 변수를 설정해서 테스트할 수 있지만, 다른 사람에게는 영향을 미치지 않음
- 이 절차를 잊어버리거나 잘못 수행하여 프로덕션에 잘못된 코드를 넣지 않도록 주의해야함
- 동일한 코드의 두 복사본이 실행되고 있고, if문이 존재하기때문에 이 코드들을 프로덕션에 오래 유지해서는 안됨
- 토글이 올바르게 수행되고 있는지 확인하고 정기적으로 제거할 수 있음

### 추상화를 통한 분기로 추가에 의한 변경

- 기능 토글의 if else는 일시적이므로 문제를 확장시키지 않음
- 코드의 여러 위치를 변경해야하는 경우, if로 전달하기 전에 기능 플래그 내부의 부울에 **클래스로 타입 코드 대체** 패턴 사용
- 이를 `추상화를 통한 분기`라고함
- 클래스에 분기를 나타내는 속성을 추가함으로써 if문을 제거할 수 있음
- <코드 참고>

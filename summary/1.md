# 1장 리팩터링 리팩터링하기

**이번 장에서 다룰 내용**

- 리팩터링 구성요소 이해
- 일상 업무에 리팩터링 도입
- 리팩터링에 있어 안전의 중요성
- 1부의 핵심 예제 소개

코드 스멜과 단위테스트로 리팩터링을 학습하는 것은 진입 장벽이 높음

**리팩터링 구성 요소**

- 스킬: 어떤 코드가 잘못됐으며, 리팩터링이 필요한지 파악하는 스킬. 판단과 경험이 필요하며 경계가 모호하거나 다양하게 해석될 수 있으므로 학습하기 어려움
- 문화: 리팩터링에 시간을 들이는 것을 권장하는 문화와 절차가 필요함
- 도구: 우리가 하는 작업이 안전하다는 것을 보장할 무언가가 필요함. 일반적으로 자동화된 테스트

### 리팩터링이란 무엇인가?

리팩터링을 해야 하는 이유

- 코드를 더 빠르게 만들기 위해
- 더 작은 코드를 만들기 위해
- 코드를 더 일반적이거나 재사용 가능하게 하기 위해
- 코드의 가독성을 높이고 유지보수를 용이하게 하기 위해

> 리팩터링은 기능을 변경하지 않고 코드의 가독성과 유지보수가 쉽도록 코드를 변경하는 것
> 좋은 코드는 사람이 읽기 쉽고, 유지보수가 용이하며, 의도한 대로 잘 동작하는 코드

### 스킬: 무엇을 리팩터링할 것인가?

- 코드 스멜은 코드가 나쁘다는 것을 암시함
- 강력하지만 추상적이고 시작하기 어려우며 감각을 키우는데 시간이 걸림
- 리팩터링 규칙을 사용하여 쉽고 빠르게 배울 수 있음
- 코드 스멜의 예) 함수는 한 가지 작업을 수행해야 한다
- 규칙의 예) 다섯 줄 제한

### 문화: 리팩터링은 언제 할까?

**프로그래밍 작업으로 문제를 해결할 때 사용하는 6단계 작업 절차**

- 탐색: 무엇을 만들어여하는지 확신이 서지 않거나 요건이 모호하거나, 문제를 해결할 수 있을지 아직 모르는 경우, 실험부터 시작해야함
- 명세화: 무엇을 만들지 알게되면 명세화함. 최적의 경우 자동화된 테스트로 명세화
- 구현: 코드 구현
- 테스트: 코드가 명세를 따르는지 확인
- 리팩터링: 코드를 전달하기 전에 다음 사람이 쉽게 작업할 수 있는지 확인
- 전달: Git PR, push 등

**리팩터링 단계**

1. 메서드 선택
2. 메서드가 규칙을 위반 했는가? -> 아니요 -> 1번으로
3. 규칙에 해당하는 리팩터링 찾기
4. 지시에 따르기
5. 모든 컴파일 오류 찾기 -> 2번으로

**레거시 시스템에서의 리팩터링**

- 대규모 레거시 시스템에서 리팩터링을 시작할 때 모든 것을 중단한 후 코드 베이스 전체를 먼저 리팩터링 하는 것보다 더 좋은 방법이 있음
- 우선 변경하기 쉽게 만든 후 변경하라
- 새로운 것을 구현할 때마다 새 코드를 쉽게 추가할 수 있게 리팩터링을 먼저 수행

**리팩터링이 필요없는 경우**

- 한 번 실행하고 삭제할 코드 (익스트림 프로그래밍 커뮤니티에서 스파이크로 알려진 것)
- 폐기되지 전 유지보수 모드에 있는 코드
- 임베디드 시스템이나 게임의 고급 물리엔진과 같이 엄격한 성능 요구사항이 있는 코드

### 도구: (안전한) 리팩터링 방법

- 자동화된 테스트가 있으면 좋지만, 리팩터링을 학습하는 단계에서하면 진입장벽이 높아지므로 여기서는 생략함
- 여기에선 자동화된 테스트 대신 레시피처럼 상세하고 단계별로 구조화된 리팩터링 패턴, 버전 관리, 컴파일러에 의존하는 것이 좋음

### 시작하는데 필요한 도구

언어: 타입스크립트
편집기: VSCode
버전 관리: Git

### 핵심 예제

https://github.com/wikibook/five-lines

### 실제 환경에서 소프트웨어에 대한 주의사항

1. 규칙 이름 따르기
2. 규칙 설명 따르기
3. 코드 스멜 마스터하기

## 요약

- 리팩터링을 수행하려면 스킬, 문화, 도구의 조합이 필요함
- 일반적으로 코드 스멜을 리팩터링 대상을 설명하는데 사용됨
- 자동화된 테스트와 리팩터링을 별도로 학습하면 진입 장벽을 낮출 수 있음
- 리팩터링의 작업 절차는 레드-그린-리팩터 반복에서 TDD로 연결됨
- 탐색, 명세화, 구현, 테스트, 리팩터링, 전달 순서로, 코드를 변경하기 직전에 리팩터링을 수행하는 것을 권장
- 책 1부에서는 비주얼 스튜디오 코드, 타입스크립트, Git을 사용해 2D 퍼즐 게임의 소스 코드를 바꿈
